<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gu√≠a Interactiva de Derecho Romano</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.plot.ly/plotly-2.20.0.min.js" charset="utf-8"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;600;700&family=Lato:wght@400;700&family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Lato', sans-serif; color: #1e293b; }
        h1, h2, h3, .font-heading { font-family: 'Cormorant Garamond', serif; }
        .bg-primary { background-color: #f5f5f4; }
        .text-primary { color: #78350f; }
        .text-secondary { color: #334155; }
        .infographic-font { font-family: 'Inter', sans-serif; }
        .loader { border: 4px solid #f3f3f3; border-top: 4px solid #C70039; border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="bg-primary flex min-h-screen">

    <header class="md:hidden p-4 bg-slate-800 text-white flex items-center justify-between shadow-lg z-30 fixed top-0 left-0 right-0">
        <h1 class="font-heading text-2xl font-bold text-amber-500">Derecho Romano</h1>
        <button id="menu-button" class="text-white focus:outline-none">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
        </button>
    </header>

    <aside id="sidebar" class="w-64 bg-slate-800 text-white p-6 shadow-lg fixed md:relative top-0 left-0 h-full transform -translate-x-full transition-transform duration-200 ease-in-out z-20 flex-col md:flex md:translate-x-0 pt-20 overflow-y-auto">
        <h1 class="font-heading text-3xl font-bold text-amber-500 mb-6 hidden md:block">Derecho Romano</h1>
        <nav class="flex-grow">
            <ul class="space-y-2">
                <li><a href="#home" class="block p-2 rounded transition-colors duration-200 text-white hover:bg-slate-700">Presentaci√≥n</a></li>
                <li><a href="#infografia" class="block p-2 rounded transition-colors duration-200 text-white hover:bg-slate-700">Infograf√≠a Interactiva</a></li>
                <li><a href="#caselab" class="block p-2 rounded transition-colors duration-200 text-white hover:bg-slate-700">Laboratorio de Casos</a></li>
                <li><a href="#ulpiano" class="block p-2 rounded transition-colors duration-200 text-white hover:bg-slate-700">Consulta a UlpianoIA</a></li>
                <li><a href="#bloque1" class="block p-2 rounded transition-colors duration-200 text-white hover:bg-slate-700">Bloque I: Fundamentos</a></li>
                <li><a href="#bloque2" class="block p-2 rounded transition-colors duration-200 text-white hover:bg-slate-700">Bloque II: Sujetos de Derecho</a></li>
                <li><a href="#bloque3" class="block p-2 rounded transition-colors duration-200 text-white hover:bg-slate-700">Bloque III: Negocio Jur√≠dico</a></li>
                <li><a href="#bloque4" class="block p-2 rounded transition-colors duration-200 text-white hover:bg-slate-700">Bloque IV: Procedimiento</a></li>
                <li><a href="#bloque5" class="block p-2 rounded transition-colors duration-200 text-white hover:bg-slate-700">Bloque V: Derechos Reales</a></li>
                <li><a href="#bloque6" class="block p-2 rounded transition-colors duration-200 text-white hover:bg-slate-700">Bloque VI: Obligaciones y Contratos</a></li>
                <li><a href="#bloque7" class="block p-2 rounded transition-colors duration-200 text-white hover:bg-slate-700">Bloque VII: Sucesiones</a></li>
                
                <li><a href="#bibliografia" class="block p-2 rounded transition-colors duration-200 text-white hover:bg-slate-700">Bibliograf√≠a</a></li>
            </ul>
        </nav>
        <div class="mt-8 text-sm text-slate-400">
            <p>¬© 2025. <a href="https://webs.um.es/adiaz-bautista/" target="_blank" class="hover:underline text-amber-500">Adolfo A. D√≠az-Bautista Cremades</a>. Universidad de Murcia</p>
        </div>
    </aside>

    <div id="sidebar-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-10 hidden"></div>

    <main id="content-area" class="flex-1 p-8 overflow-y-auto pt-16 md:pt-8"></main>
    
    <div id="explanation-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-lg shadow-2xl p-6 max-w-md w-full">
            <h3 id="explanation-modal-title" class="text-2xl font-bold text-[#900C3F] mb-4 infographic-font">Explicaci√≥n Sencilla</h3>
            <div id="explanation-modal-content" class="min-h-[100px]"><div class="loader mx-auto"></div></div>
            <button id="close-explanation-modal-btn" class="mt-6 bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded-lg hover:bg-gray-400 transition-colors w-full">Cerrar</button>
        </div>
    </div>

    <script>
        const contentArea = document.getElementById('content-area');
        const sidebar = document.getElementById('sidebar');
        const menuButton = document.getElementById('menu-button');
        const sidebarOverlay = document.getElementById('sidebar-overlay');

        // --- LISTA GLOBAL PARA EL FILTRO ANTI-TROLEO ---
        const palabrasProhibidas = ['tonto', 'sexo', 'idiota', 'imbecil', 'puta', 'mierda', 'gilipollas', 'franco', 'hitler', 'mussolini', 'stalin', 'polla', 'picha', 'acho', 'puto', 'zorra', 'zorras', 'tetas', 'pollas', 'cabron', 'cabr√≥n', 'teta', 'co√±o', 'examen', 'test'];
        const respuestaCiceron = `Quo usque tandem abutere, Catilina, patientia nostra? Quam diu etiam furor iste tuus nos eludet? Quem ad finem sese effrenata iactabit audacia? Nihilne te nocturnum praesidium Palati, nihil urbis uigiliae, nihil timor populi, nihil concursus bonorum omnium, nihil hic munitissimus habendi senatus locus, nihil horum ora uoltusque mouerunt? Patere tua consilia non sentis, constrictam iam horum omnium scientia teneri coniurationem tuam non uides? Quid proxima, quid superiore nocte egeris, ubi fueris, quos conuocaueris, quid consili ceperis quem nostrum ignorare arbitraris? O tempora, o mores! Senatus haec intellegit, consul uidet; hic tamen uiuit. Viuit? Immo uero etiam in senatum uenit, fit publici consili particeps, notat et designat oculis ad caedem unum quemque nostrum. Nos autem fortes uiri satis facere rei publicae uidemur, si istius furorem ac tela uitamus.`;


        const contentMap = {
            '#home': {
                title: 'Presentaci√≥n de la Asignatura',
                html: `<div class="prose max-w-none"><h2 class="text-3xl font-bold text-secondary mb-4">Bienvenida al curso de Derecho Romano</h2><p class="mb-4">Esta asignatura es vuestra primera toma de contacto con el razonamiento jur√≠dico. El objetivo principal es que aprend√°is a identificar problemas, a encontrar la norma o principio aplicable y a argumentar una soluci√≥n. Este enfoque ser√° la base de vuestra evaluaci√≥n y de vuestra formaci√≥n como juristas.</p><h3 class="text-2xl font-semibold text-secondary mb-2">Recursos y Metodolog√≠a</h3><p class="mb-4">Para facilitar vuestro aprendizaje, hemos preparado una serie de recursos. A continuaci√≥n, encontrar√©is la presentaci√≥n de la asignatura y el material de estudio para cada tema. Es fundamental que le√°is el tema correspondiente del manual <strong>antes</strong> de la clase y utilic√©is los guiones como un mapa, complet√°ndolos con las explicaciones del profesor y los ejemplos pr√°cticos.</p><div class="p-4 bg-white rounded-lg shadow-md mt-6"><h4 class="text-xl font-semibold text-primary mb-2">Gui√≥n 0: Presentaci√≥n de la asignatura</h4><p class="text-secondary mb-3">Aqu√≠ encontrar√°s el documento con toda la informaci√≥n general del curso, el sistema de evaluaci√≥n y consejos para superarla con √©xito.</p><a href="0. presentacion.pdf" target="_blank" class="text-amber-600 hover:text-amber-800 font-bold">Ver Presentaci√≥n de la asignatura</a></div></div>`
            },
            '#infografia': {
                title: 'Infograf√≠a Interactiva: El Legado de Roma',
                html: `<div class="infographic-font text-[#212529]"><header class="text-center mb-12"><h1 class="text-4xl md:text-6xl font-black text-[#C70039] mb-4">El Legado Vivo de Roma</h1><p class="text-xl md:text-2xl max-w-3xl mx-auto">Descubre visualmente c√≥mo el Derecho Romano es el sistema operativo de nuestro mundo legal actual.</p></header><main class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"><section class="md:col-span-2 lg:col-span-3 bg-white rounded-lg shadow-md p-6 flex flex-col md:flex-row items-center justify-center text-center"><div class="md:w-1/2"><h2 class="text-2xl font-bold text-[#900C3F] mb-2">Influencia Global</h2><p class="text-lg mb-4">Los principios del Derecho Romano son la base de los sistemas jur√≠dicos que rigen a miles de millones de personas en todo el mundo.</p></div><div class="md:w-1/2"><p class="kpi-number">60%</p><p class="text-lg font-bold">De la poblaci√≥n mundial vive bajo sistemas de Derecho Civil derivados de Roma.</p></div></section><section class="md:col-span-2 lg:col-span-3 bg-white rounded-lg shadow-md p-6"><h2 class="text-3xl font-bold text-center text-[#900C3F] mb-4">El ADN de Nuestras Leyes</h2><p class="text-center max-w-4xl mx-auto mb-6">La mayor√≠a de los pa√≠ses de Europa y toda Am√©rica Latina adoptaron el sistema de Derecho Continental o Civil, una evoluci√≥n directa del Derecho Romano. Este mapa muestra la extensi√≥n de su influencia fundamental.</p><div id="mapChart" class="plot-container"></div></section><section class="bg-white rounded-lg shadow-md p-6"><h2 class="text-2xl font-bold text-center text-[#900C3F] mb-4">Sistemas Legales en el Mundo</h2><p class="text-center mb-4">El Derecho Civil, de ra√≠z romana, es el sistema predominante a nivel global, demostrando su incre√≠ble perdurabilidad y adaptabilidad a trav√©s de los siglos.</p><div class="chart-container"><canvas id="donutChart"></canvas></div></section><section class="lg:col-span-2 bg-white rounded-lg shadow-md p-6"><h2 class="text-2xl font-bold text-center text-[#900C3F] mb-4">Conceptos Fundamentales Forjados en Roma</h2><p class="text-center mb-6">T√©rminos que son el pan de cada d√≠a para cualquier abogado fueron meticulosamente definidos y desarrollados por los juristas romanos.</p><div class="grid grid-cols-1 sm:grid-cols-2 gap-4 text-center"><div class="bg-gray-100 p-4 rounded-lg"><div class="flex items-center justify-center mb-2"><p class="text-5xl">üë§</p><button class="gemini-explain-btn ml-3 text-2xl" data-concept="Persona">‚ú®</button></div><h3 class="font-bold text-lg">Persona</h3><p>Definici√≥n del sujeto de derechos y obligaciones.</p></div><div class="bg-gray-100 p-4 rounded-lg"><div class="flex items-center justify-center mb-2"><p class="text-5xl">ü§ù</p><button class="gemini-explain-btn ml-3 text-2xl" data-concept="Contrato">‚ú®</button></div><h3 class="font-bold text-lg">Contrato</h3><p>El acuerdo de voluntades como fuente de obligaciones.</p></div><div class="bg-gray-100 p-4 rounded-lg"><div class="flex items-center justify-center mb-2"><p class="text-5xl">üè†</p><button class="gemini-explain-btn ml-3 text-2xl" data-concept="Propiedad">‚ú®</button></div><h3 class="font-bold text-lg">Propiedad</h3><p>El derecho de usar, gozar y disponer de una cosa.</p></div><div class="bg-gray-100 p-4 rounded-lg"><div class="flex items-center justify-center mb-2"><p class="text-5xl">üîó</p><button class="gemini-explain-btn ml-3 text-2xl" data-concept="Obligaci√≥n">‚ú®</button></div><h3 class="font-bold text-lg">Obligaci√≥n</h3><p>El v√≠nculo jur√≠dico que nos obliga a dar, hacer o no hacer algo.</p></div></div></section><section class="md:col-span-2 lg:col-span-3 bg-white rounded-lg shadow-md p-6"><h2 class="text-3xl font-bold text-center text-[#900C3F] mb-4">El Gimnasio de la Mente Jur√≠dica</h2><p class="text-center max-w-4xl mx-auto mb-8">M√°s que leyes antiguas, el Derecho Romano es un m√©todo. Ense√±a un proceso de razonamiento riguroso para resolver problemas complejos, una habilidad esencial para cualquier jurista de √©xito.</p><div class="flex flex-col md:flex-row items-center justify-center space-y-4 md:space-y-0 md:space-x-4"><div class="flowchart-step">An√°lisis del Caso</div><div class="flowchart-arrow transform md:-rotate-0 rotate-90">‚Üí</div><div class="flowchart-step">Construcci√≥n de Argumentos</div><div class="flowchart-arrow transform md:-rotate-0 rotate-90">‚Üí</div><div class="flowchart-step">B√∫squeda de la Soluci√≥n Justa</div></div></section></main></div>`
            },
            '#caselab': {
                title: 'Laboratorio de Casos Romanos',
                html: `<section class="infographic-font bg-white rounded-lg shadow-md p-6"><h2 class="text-3xl font-bold text-center text-[#900C3F] mb-4">Laboratorio de Casos Romanos</h2><p class="text-center max-w-4xl mx-auto mb-6">Introduce un concepto de derecho romano (ej: usufructo, dote, compraventa) y la IA generar√° un caso de estudio para que lo analices.</p><div class="text-center text-sm text-gray-500 mb-6 bg-amber-50 border border-amber-200 rounded-lg p-3 max-w-xl mx-auto"><p><strong>Advertencia:</strong> Los casos y soluciones son generados por la IA de Google (Gemini) y no han sido supervisados por el profesor. √ösalos como una herramienta de pr√°ctica y no como una fuente autorizada.</p></div><div class="max-w-xl mx-auto"><div class="flex flex-col sm:flex-row gap-2"><input type="text" id="case-study-input" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#FF5733]" placeholder="Ej: Usufructo"><button id="generate-case-btn" class="bg-[#C70039] text-white font-bold py-2 px-6 rounded-lg hover:bg-[#900C3F] transition-colors flex items-center justify-center"><span id="btn-text">‚ú® Generar Caso</span><div id="btn-loader" class="loader hidden"></div></button></div><div id="case-study-result" class="mt-6 p-4 bg-gray-50 rounded-lg border border-gray-200 min-h-[100px]"><p class="text-gray-500">Aqu√≠ aparecer√° tu caso de estudio...</p></div><div class="text-center mt-4"><button id="solve-case-btn" class="hidden bg-[#FF5733] text-white font-bold py-2 px-6 rounded-lg hover:bg-[#C70039] transition-colors flex items-center justify-center mx-auto"><span id="solve-btn-text">Ver Soluci√≥n</span><div id="solve-btn-loader" class="loader hidden"></div></button></div><div id="case-solution-result" class="hidden mt-6 p-4 bg-green-50 rounded-lg border border-green-200"></div>
                <div id="chat-follow-up" class="hidden mt-8 border-t pt-6">
                    <h4 class="font-bold text-lg mb-4 text-gray-800">¬øNecesitas m√°s detalles? ¬°Preg√∫ntame!</h4>
                    <div id="chat-conversation" class="h-64 overflow-y-auto p-4 bg-gray-50 rounded-md mb-4 border space-y-4"></div>
                    <div class="flex items-center">
                        <input type="text" id="chat-input" class="flex-grow border rounded-l-md p-2 focus:outline-none focus:ring-2 focus:ring-green-700" placeholder="Escribe aqu√≠ tu pregunta...">
                        <button id="send-chat-btn" class="bg-green-800 text-white px-4 py-2 rounded-r-md hover:bg-green-900 flex items-center justify-center" style="min-width: 100px;">
                            <span id="send-btn-text">Enviar</span>
                            <div id="send-btn-loader" class="loader hidden" style="border-top-color: #fff; width:20px; height:20px;"></div>
                        </button>
                    </div>
                </div>
                </div></section>`
            },
            '#ulpiano': {
                title: 'Consulta a UlpianoIA',
                html: `<section class="infographic-font bg-white rounded-lg shadow-md p-6" style="color: #333;">
                        <h2 class="text-3xl font-bold text-center text-[#900C3F] mb-4">Consulta a UlpianoIA</h2>
                        <p class="text-center max-w-4xl mx-auto mb-6">Hazle una pregunta a UlpianoIA sobre cualquier tema de Derecho Romano.</p>
                        <div class="text-center text-sm text-gray-500 mb-6 bg-amber-50 border border-amber-200 rounded-lg p-3 max-w-xl mx-auto"><p><strong>Advertencia:</strong> Las respuestas de Ulpiano son generadas por la IA de Google (Gemini) y no han sido supervisadas por el profesor. √ösalas como una herramienta de apoyo y no como una fuente autorizada para tus ex√°menes.</p></div>
                        <div class="max-w-xl mx-auto">
                            <div class="flex flex-col sm:flex-row gap-2">
                                <textarea id="queryInput" rows="4" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#FF5733]"></textarea>
                                <button id="submitQueryBtn" class="bg-[#C70039] text-white font-bold py-2 px-6 rounded-lg hover:bg-[#900C3F] transition-colors flex items-center justify-center">
                                    <span id="submit-btn-text">‚ú® Enviar consulta</span>
                                    <div id="submit-btn-loader" class="loader hidden" style="border-top-color: #fff; width:20px; height:20px;"></div>
                                </button>
                            </div>
                            <div id="queryResult" class="mt-6 p-4 bg-gray-50 rounded-lg border border-gray-200 hidden">
                                <h3 class="text-xl font-semibold mb-2 text-[#900C3F]">Respuesta de UlpianoIA:</h3>
                                <p id="queryResultText"></p>
                            </div>
                            <div id="chat-follow-up-ulpiano" class="hidden mt-8 border-t pt-6">
                                <h4 class="font-bold text-lg mb-4 text-gray-800">¬øNecesitas m√°s detalles? ¬°Preg√∫ntame!</h4>
                                <div id="chat-conversation-ulpiano" class="h-64 overflow-y-auto p-4 bg-gray-50 rounded-md mb-4 border space-y-4"></div>
                                <div class="flex items-center">
                                    <input type="text" id="chat-input-ulpiano" class="flex-grow border rounded-l-md p-2 focus:outline-none focus:ring-2 focus:ring-green-700" placeholder="Escribe aqu√≠ tu pregunta...">
                                    <button id="send-chat-btn-ulpiano" class="bg-green-800 text-white px-4 py-2 rounded-r-md hover:bg-green-900 flex items-center justify-center" style="min-width: 100px;">
                                        <span id="send-btn-text-ulpiano">Enviar</span>
                                        <div id="send-btn-loader-ulpiano" class="loader hidden" style="border-top-color: #fff; width:20px; height:20px;"></div>
                                    </button>
                                </div>
                            </div>
                        </div>
                       </section>`
            },
            '#bloque1': {
                title: 'Bloque I: Fundamentos del Derecho Romano',
                html: `<section class="prose max-w-none"><p class="mb-4">Este bloque introduce los conceptos m√°s b√°sicos para comprender el Derecho. Exploraremos la diferencia entre los distintos tipos de normas de conducta, la aportaci√≥n fundamental de Roma al Derecho y su evoluci√≥n hist√≥rica, as√≠ como su pervivencia hasta nuestros d√≠as.</p><div class="space-y-4 mt-6"><div class="p-4 bg-white rounded-lg shadow-md"><h4 class="text-xl font-semibold text-primary mb-2">Tema 1: Ideas fundamentales acerca del Derecho</h4><p class="text-secondary mb-3">Este tema aborda las nociones primarias del Derecho, diferenciando entre distintas normas de conducta y sentando las bases del pensamiento jur√≠dico. Es la puerta de entrada a la asignatura, fundamental para entender el resto de conceptos que se desarrollar√°n a lo largo del curso.</p><div class="flex flex-wrap gap-4 mt-3"><a href="1. introduccion.pdf" target="_blank" class="text-amber-600 hover:text-amber-800 font-bold">Ver Guion del Tema 1</a><a href="https://open.spotify.com/episode/7EBPwjNWNeesrvtUgn1z1H?si=Zq5Yc1qDSxuhWl97MVkboA" target="_blank" class="text-amber-600 hover:text-amber-800 font-bold">Escuchar Podcast</a></div></div><div class="p-4 bg-white rounded-lg shadow-md"><h4 class="text-xl font-semibold text-primary mb-2">Tema 2: Breve introducci√≥n a la historia del Derecho Romano</h4><p class="text-secondary mb-3">Este tema presenta la evoluci√≥n hist√≥rica del Derecho Romano, desde la √©poca arcaica hasta la compilaci√≥n justinianea. Entender la periodizaci√≥n hist√≥rica es clave para contextualizar la creaci√≥n y aplicaci√≥n de las normas a lo largo del tiempo.</p><div class="flex flex-wrap gap-4 mt-3"><a href="2. historia.pdf" target="_blank" class="text-amber-600 hover:text-amber-800 font-bold">Ver Guion del Tema 2</a><a href="https://open.spotify.com/episode/6cU7dpW7hutUqkMGgh8Skc?si=DsBw44jfQoap7pBlo6t_zQ" target="_blank" class="text-amber-600 hover:text-amber-800 font-bold">Escuchar Podcast</a></div></div><div class="p-4 bg-white rounded-lg shadow-md"><h4 class="text-xl font-semibold text-primary mb-2">Tema 3: La persistencia del Derecho Romano</h4><p class="text-secondary mb-3">Analiza la pervivencia del Derecho Romano y su influencia en los sistemas jur√≠dicos modernos. Se estudia c√≥mo el Derecho Romano sent√≥ las bases para el Derecho Civil, P√∫blico y Mercantil, siendo un pilar fundamental en la formaci√≥n de la tradici√≥n jur√≠dica continental.</p><div class="flex flex-wrap gap-4 mt-3"><a href="3. persistencia.pdf" target="_blank" class="text-amber-600 hover:text-amber-800 font-bold">Ver Guion del Tema 3</a><a href="https://open.spotify.com/episode/2HKvLfGckWNzmzewxHrnYv?si=kTlHzhCJTF--_8qMbK-DpQ" target="_blank" class="text-amber-600 hover:text-amber-800 font-bold">Escuchar Podcast</a></div></div></div></section>` 
            },
            '#bloque2': {
                title: 'Bloque II: Sujetos de Derecho',
                html: `<section class="prose max-w-none"><p class="mb-4">Este bloque se centra en qui√©nes son los protagonistas del Derecho. Analizaremos los requisitos para ser persona en Roma, la estructura de la familia y los poderes que ostentaba el paterfamilias.</p><div class="space-y-4 mt-6"><div class="p-4 bg-white rounded-lg shadow-md"><h4 class="text-xl font-semibold text-primary mb-2">Tema 4: El sujeto del derecho. La persona. La capacidad.</h4><p class="text-secondary mb-3">Estudio de los requisitos para ostentar la condici√≥n de persona y ser sujeto de derechos en Roma. Se examinan los conceptos de capacidad jur√≠dica y capacidad de obrar, as√≠ como las restricciones que pod√≠an afectar a la condici√≥n jur√≠dica de los individuos, como la esclavitud o la p√©rdida de la ciudadan√≠a.</p><div class="flex flex-wrap gap-4 mt-3"><a href="4. persona.pdf" target="_blank" class="text-amber-600 hover:text-amber-800 font-bold">Ver Guion del Tema 4</a><a href="https://open.spotify.com/episode/6D2mPBSBGo8AcyGWXO914i?si=btU9P3-nRryXxr_vFvu0Kw" target="_blank" class="text-amber-600 hover:text-amber-800 font-bold">Escuchar Podcast</a></div></div><div class="p-4 bg-white rounded-lg shadow-md"><h4 class="text-xl font-semibold text-primary mb-2">Tema 5: La familia</h4><p class="text-secondary mb-3">An√°lisis de la organizaci√≥n familiar romana, una estructura social y jur√≠dica fundamental. Se estudian figuras como la patria potestas, la condici√≥n de los filii familias y la diferenciaci√≥n entre los conceptos de familia agnaticia y cognaticia.</p><div class="flex flex-wrap gap-4 mt-3"><a href="5. familia.pdf" target="_blank" class="text-amber-600 hover:text-amber-800 font-bold">Ver Guion del Tema 5</a><a href="https://open.spotify.com/episode/677MZlIOUO1eCMyec6AtnZ?si=9etnCEy0S92jHp88-NXWog" target="_blank" class="text-amber-600 hover:text-amber-800 font-bold">Escuchar Podcast</a></div></div></div></section>`
            },
            '#bloque3': {
                title: 'Bloque III: El Negocio Jur√≠dico',
                html: `<section class="prose max-w-none"><p class="mb-4">Este bloque es crucial para la comprensi√≥n de los actos voluntarios con efectos jur√≠dicos. Analizaremos los elementos esenciales y accidentales de los negocios jur√≠dicos y las causas que pueden llevar a su ineficacia.</p><div class="space-y-4 mt-6"><div class="p-4 bg-white rounded-lg shadow-md"><h4 class="text-xl font-semibold text-primary mb-2">Tema 6: Hechos, actos y negocios jur√≠dicos</h4><p class="text-secondary mb-3">Se exploran las bases de los negocios jur√≠dicos, que son las declaraciones de voluntad destinadas a producir efectos jur√≠dicos. Se diferencian de los hechos y actos jur√≠dicos, y se estudian los elementos esenciales (capacidad, objeto, causa) y accidentales (condici√≥n, t√©rmino, modo).</p><div class="flex flex-wrap gap-4 mt-3"><a href="6. negocio.pdf" target="_blank" class="text-amber-600 hover:text-amber-800 font-bold">Ver Guion del Tema 6</a><a href="https://open.spotify.com/episode/4o6JhmuT1p0ghazrVCR36z?si=ENP_QlRGQXay7bZF_HpOtg" target="_blank" class="text-amber-600 hover:text-amber-800 font-bold">Escuchar Podcast</a></div></div></div></section>`
            },
            '#bloque4': {
                title: 'Bloque IV: El Procedimiento',
                html: `<section class="prose max-w-none"><p class="mb-4">Introducci√≥n al sistema procesal romano. Comprender√°s la diferencia entre las acciones reales y personales, el desarrollo del proceso formulario y las distintas fases que lo compon√≠an, desde la *ius vocatio* hasta la sentencia.</p><div class="space-y-4 mt-6"><div class="p-4 bg-white rounded-lg shadow-md"><h4 class="text-xl font-semibold text-primary mb-2">Tema 7: El proceso civil romano I</h4><p class="text-secondary mb-3">Este tema introduce el procedimiento civil romano y la distinci√≥n fundamental entre acciones reales y personales, sentando las bases para el estudio de los litigios y su resoluci√≥n.</p><div class="flex flex-wrap gap-4 mt-3"><a href="7. proceso I.pdf" target="_blank" class="text-amber-600 hover:text-amber-800 font-bold">Ver Guion del Tema 7</a><a href="https://open.spotify.com/episode/4Kxm6qJUtJOr6sY2BswiJd?si=n1wMFv9FSYaMq1tvjrvwAQ" target="_blank" class="text-amber-600 hover:text-amber-800 font-bold">Escuchar Podcast</a></div></div><div class="p-4 bg-white rounded-lg shadow-md"><h4 class="text-xl font-semibold text-primary mb-2">Tema 8: El proceso civil romano II</h4><p class="text-secondary mb-3">Se profundiza en el procedimiento formulario, su estructura bif√°sica (in iure y apud iudicem) y el papel de la f√≥rmula, que conten√≠a la clave del litigio. Es la parte central del estudio procesal de la asignatura.</p><div class="flex flex-wrap gap-4 mt-3"><a href="8. proceso II.pdf" target="_blank" class="text-amber-600 hover:text-amber-800 font-bold">Ver Guion del tema 8</a><a href="https://open.spotify.com/episode/5GhFnFfrdhxX7Nh8GEaDU0?si=uuOQwGc4SXOojVk0eX4NhQ" target="_blank" class="text-amber-600 hover:text-amber-800 font-bold">Escuchar Podcast</a></div></div><div class="p-4 bg-white rounded-lg shadow-md"><h4 class="text-xl font-semibold text-primary mb-2">Tema 9: El proceso civil romano III</h4><p class="text-secondary mb-3">Este tema se centra en las diferentes partes de la f√≥rmula y las excepciones procesales, as√≠ como la ejecuci√≥n de la sentencia y los recursos disponibles en el procedimiento cl√°sico.</p><div class="flex flex-wrap gap-4 mt-3"><a href="9. proceso III.pdf" target="_blank" class="text-amber-600 hover:text-amber-800 font-bold">Ver Guion del Tema 9</a><a href="https://open.spotify.com/episode/2LBOetDA2jmWk5LS1M4KRn?si=XXOyNe6iQo2It5zbou9NGQ" target="_blank" class="text-amber-600 hover:text-amber-800 font-bold">Escuchar Podcast</a></div></div><div class="p-4 bg-white rounded-lg shadow-md"><h4 class="text-xl font-semibold text-primary mb-2">Tema 10: El proceso civil romano IV</h4><p class="text-secondary mb-3">Se examinan otros procedimientos como la *cognitio extra ordinem* y los procedimientos especiales, marcando la transici√≥n hacia un sistema procesal diferente al formulario.</p><div class="flex flex-wrap gap-4 mt-3"><a href="10. proceso IV.pdf" target="_blank" class="text-amber-600 hover:text-amber-800 font-bold">Ver Guion del Tema 10</a><a href="https://open.spotify.com/episode/72D8BGd96H4YvJmk5cuqJd?si=qrdoDx0VQ-ex-2uIVodkSA" target="_blank" class="text-amber-600 hover:text-amber-800 font-bold">Escuchar Podcast</a></div></div></div></section>`
            },
            '#bloque5': {
                title: 'Bloque V: Derechos Reales',
                html: `<section class="prose max-w-none"><p class="mb-4">Este bloque es fundamental en el estudio del Derecho de Cosas. Estudiar√°s la diferencia entre derechos reales y de obligaci√≥n, el concepto de propiedad, los modos de adquirirla y la protecci√≥n jur√≠dica de la posesi√≥n.</p><div class="space-y-4 mt-6"><div class="p-4 bg-white rounded-lg shadow-md"><h4 class="text-xl font-semibold text-primary mb-2">Tema 11: Derechos Reales I</h4><p class="text-secondary mb-3">Este tema introduce la distinci√≥n esencial entre derechos reales (poder sobre una cosa) y personales (poder sobre una persona), y los conceptos de posesi√≥n y propiedad, que son la base de este bloque tem√°tico.</p><div class="flex flex-wrap gap-4 mt-3"><a href="11. reales I.pdf" target="_blank" class="text-amber-600 hover:text-amber-800 font-bold">Ver Guion del Tema 11</a><a href="https://open.spotify.com/episode/7f7hE70hq8ZBjhptnMZB8l?si=DnGCgFrLQYKPcxV187dOKQ" target="_blank" class="text-amber-600 hover:text-amber-800 font-bold">Escuchar Podcast</a></div></div><div class="p-4 bg-white rounded-lg shadow-md"><h4 class="text-xl font-semibold text-primary mb-2">Tema 12: Derechos Reales II</h4><p class="text-secondary mb-3">Se analizan los diversos modos de adquisici√≥n de la propiedad, como la *mancipatio* y la *traditio*, as√≠ como las limitaciones y protecciones que exist√≠an sobre este derecho.</p><div class="flex flex-wrap gap-4 mt-3"><a href="12. reales II.pdf" target="_blank" class="text-amber-600 hover:text-amber-800 font-bold">Ver Guion del Tema 12</a><a href="https://open.spotify.com/episode/2TJUMq96W2ZZpjmZ93fqSJ?si=8cCSj59HS5ac7fuh-6MCgA" target="_blank" class="text-amber-600 hover:text-amber-800 font-bold">Escuchar Podcast</a></div></div><div class="p-4 bg-white rounded-lg shadow-md"><h4 class="text-xl font-semibold text-primary mb-2">Tema 13: Derechos Reales III</h4><p class="text-secondary mb-3">Este tema se centra en los mecanismos procesales para la protecci√≥n de la propiedad y la posesi√≥n, as√≠ como en el estudio de los derechos reales sobre cosa ajena (*iura in re aliena*), como las servidumbres y el usufructo.</p><div class="flex flex-wrap gap-4 mt-3"><a href="13. reales III.pdf" target="_blank" class="text-amber-600 hover:text-amber-800 font-bold">Ver Guion del Tema 13</a><a href="https://open.spotify.com/episode/1ogj4z9c7svGaA5rws6vX2?si=XDBRM1b6QRmEXEIHsuppeQ" target="_blank" class="text-amber-600 hover:text-amber-800 font-bold">Escuchar Podcast</a></div></div></div></section>`
            },
            '#bloque6': {
                title: 'Bloque VI: Obligaciones y Contratos',
                html: `<section class="prose max-w-none"><p class="mb-4">Aqu√≠ analizaremos la esencia de las relaciones jur√≠dicas entre personas. Diferenciaremos entre las diversas fuentes de las obligaciones y las figuras contractuales m√°s importantes del Derecho Romano.</p><div class="space-y-4 mt-6"><div class="p-4 bg-white rounded-lg shadow-md"><h4 class="text-xl font-semibold text-primary mb-2">Tema 14: La relaci√≥n obligacional. Introducci√≥n</h4><p class="text-secondary mb-3">Este tema introduce el concepto de obligaci√≥n, que es el v√≠nculo jur√≠dico por el cual una persona se encuentra constre√±ida a cumplir una determinada prestaci√≥n. Se estudian los elementos de la obligaci√≥n, sus clases y los efectos que produce su cumplimiento o incumplimiento.</p><div class="flex flex-wrap gap-4 mt-3"><a href="14. obligaciones I.pdf" target="_blank" class="text-amber-600 hover:text-amber-800 font-bold">Ver Gui√≥n del Tema 14</a><a href="https://open.spotify.com/episode/37Y0yAOpQhEVSmbM3Ms0ZM?si=kD_aVR3nSOOfCtT7zOW88w" target="_blank" class="text-amber-600 hover:text-amber-800 font-bold">Escuchar Podcast</a></div></div><div class="p-4 bg-white rounded-lg shadow-md"><h4 class="text-xl font-semibold text-primary mb-2">Tema 15: Los delitos</h4><p class="text-secondary mb-3">Se abordan los delitos privados en el Derecho Romano, que generaban una obligaci√≥n de resarcir el da√±o causado. Se estudian los principales delitos (*furtum*, *rapina*, *iniuria*, *damnum iniuria datum*) y las acciones procesales para perseguirlos, sentando las bases de la responsabilidad extracontractual.</p><div class="flex flex-wrap gap-4 mt-3"><a href="15. obligaciones II.pdf" target="_blank" class="text-amber-600 hover:text-amber-800 font-bold">Ver Gui√≥n del Tema 15</a><a href="https://open.spotify.com/episode/4dpBJ4zlYf3pC434CwQdPd?si=7DRazvsURbWosyEChBNQMA" target="_blank" class="text-amber-600 hover:text-amber-800 font-bold">Escuchar Podcast</a></div></div><div class="p-4 bg-white rounded-lg shadow-md"><h4 class="text-xl font-semibold text-primary mb-2">Tema 16: Contratos en general</h4><p class="text-secondary mb-3">Este tema ofrece una visi√≥n general de la teor√≠a contractual romana. Se distinguen las diferentes categor√≠as de contratos (reales, verbales, literales y consensuales) y se profundiza en los requisitos y la eficacia de los mismos, con especial atenci√≥n a los contratos innominados.</p><div class="flex flex-wrap gap-4 mt-3"><a href="16. obligaciones III.pdf" target="_blank" class="text-amber-600 hover:text-amber-800 font-bold">Ver Gui√≥n del Tema 16</a><a href="https://open.spotify.com/episode/6UH5Hs5ffo2mPmVeGYSWLg?si=o6YqSQXrS0qo_zp19UbDLw" target="_blank" class="text-amber-600 hover:text-amber-800 font-bold">Escuchar Podcast</a></div></div><div class="p-4 bg-white rounded-lg shadow-md"><h4 class="text-xl font-semibold text-primary mb-2">Tema 17: Contratos consensuales</h4><p class="text-secondary mb-3">Estudio de los contratos que se perfeccionan con el mero consentimiento de las partes. Se analizan figuras como la compraventa (*emptio venditio*), el arrendamiento (*locatio conductio*), la sociedad (*societas*) y el mandato (*mandatum*), que son la base de los contratos modernos.</p><div class="flex flex-wrap gap-4 mt-3"><a href="17. obligaciones IV.pdf" target="_blank" class="text-amber-600 hover:text-amber-800 font-bold">Ver Gui√≥n del Tema 17</a><a href="https://open.spotify.com/episode/61wnFMJtSj14T5EtqnqmAG?si=NydVTDnIR2OwSFls9y0Qvg" target="_blank" class="text-amber-600 hover:text-amber-800 font-bold">Escuchar Podcast</a></div></div><div class="p-4 bg-white rounded-lg shadow-md"><h4 class="text-xl font-semibold text-primary mb-2">Tema 18: Contratos formales</h4><p class="text-secondary mb-3">Se examinan los contratos que requieren una forma espec√≠fica para su validez. Se estudian las estipulaciones (*stipulatio*), que eran la forma m√°s com√∫n de crear obligaciones verbales, as√≠ como los contratos literales, que se perfeccionaban mediante la escritura.</p><div class="flex flex-wrap gap-4 mt-3"><a href="18. obligaciones V.pdf" target="_blank" class="text-amber-600 hover:text-amber-800 font-bold">Ver Gui√≥n del Tema 18</a><a href="https://open.spotify.com/episode/6bBrEq8ahyB3mHj8Btay16?si=J36R3fvvSbu6WSDCrx31LQ" target="_blank" class="text-amber-600 hover:text-amber-800 font-bold">Escuchar Podcast</a></div></div></div></section>`
            },
            '#bloque7': {
                title: 'Bloque VII: Derecho de Sucesiones',
                html: `<section class="prose max-w-none"><p class="mb-4">Este bloque final aborda c√≥mo se regula la sucesi√≥n de una persona. Estudiar√°s la sucesi√≥n intestada (sin testamento) y la testamentaria, con un √©nfasis especial en el testamento, los legados y los fideicomisos.</p><div class="space-y-4 mt-6"><div class="p-4 bg-white rounded-lg shadow-md"><h4 class="text-xl font-semibold text-primary mb-2">Tema 19: El derecho de sucesiones I</h4><p class="text-secondary mb-3">Este tema introduce la distinci√≥n entre sucesi√≥n intestada y testamentaria, analizando la figura del testamento como la manifestaci√≥n de voluntad m√°s importante en esta materia.</p><div class="flex flex-wrap gap-4 mt-3"><a href="19. sucesiones I.pdf" target="_blank" class="text-amber-600 hover:text-amber-800 font-bold">Ver Gui√≥n del Tema 19</a><a href="https://open.spotify.com/episode/2gvvqYT8xPP4OYErc5eE9J?si=LpIeaa3PRniE-IjccmLV2g" target="_blank" class="text-amber-600 hover:text-amber-800 font-bold">Escuchar Podcast</a></div></div><div class="p-4 bg-white rounded-lg shadow-md"><h4 class="text-xl font-semibold text-primary mb-2">Tema 20: El derecho de sucesiones II</h4><p class="text-secondary mb-3">Se abordan otros tipos de testamentos, las causas de invalidez, la desheredaci√≥n y el r√©gimen de los legados y fideicomisos, que permit√≠an al testador disponer de bienes concretos a favor de terceros.</p><div class="flex flex-wrap gap-4 mt-3"><a href="20. sucesiones II.pdf" target="_blank" class="text-amber-600 hover:text-amber-800 font-bold">Ver Gui√≥n del Tema 20</a><a href="https://open.spotify.com/episode/5GkVFHllI7hOzI0oVDpy1X?si=cKCMf5fkR_eCIjRgFDvnnQ" target="_blank" class="text-amber-600 hover:text-amber-800 font-bold">Escuchar Podcast</a></div></div><div class="p-4 bg-white rounded-lg shadow-md"><h4 class="text-xl font-semibold text-primary mb-2">Tema 21: El derecho de sucesiones III</h4><p class="text-secondary mb-3">Este tema se centra en la adquisici√≥n de la herencia, sus efectos y el r√©gimen de los herederos y los legatarios, as√≠ como la protecci√≥n procesal de la herencia.</p><div class="flex flex-wrap gap-4 mt-3"><a href="21. sucesiones III.pdf" target="_blank" class="text-amber-600 hover:text-amber-800 font-bold">Ver Gui√≥n del Tema 21</a><a href="https://open.spotify.com/episode/4mjQWbnKWMHeZoYpsgzzpA?si=umiiHBZ0QOKqg1IMyUKCvg" target="_blank" class="text-amber-600 hover:text-amber-800 font-bold">Escuchar Podcast</a></div></div></div></section>`
            },
            '#bibliografia': {
                title: 'Bibliograf√≠a y Recursos',
                html: `<section class="prose max-w-none"><h2 class="text-3xl font-bold text-secondary mb-4">Bibliograf√≠a y Recursos</h2><p class="mb-4">El manual b√°sico para la asignatura es:</p><div class="p-4 bg-white rounded-lg shadow-md"><h4 class="text-xl font-semibold text-primary">"El derecho romano como introducci√≥n al derecho"</h4><p class="text-secondary">Autores: Antonio D√≠az Bautista y Adolfo A. D√≠az-Bautista Cremades.</p><p class="text-sm text-gray-500 mb-2">Cuarta edici√≥n, 2023.</p></div><h3 class="text-2xl font-semibold text-secondary mt-8 mb-4">Otras obras recomendadas</h3><ul class="space-y-4"><li class="p-4 bg-white rounded-lg shadow-md"><p class="text-secondary mb-1"><span class="font-bold">Fern√°ndez de Buj√°n, A.</span>: Derecho Romano, Dykinson, 2024.</p></li><li class="p-4 bg-white rounded-lg shadow-md"><p class="text-secondary mb-1"><span class="font-bold">Cast√°n P√©rez-G√≥mez, S. e.a.</span>: Derecho privado romano, Reus, 2018.</p></li><li class="p-4 bg-white rounded-lg shadow-md"><p class="text-secondary mb-1"><span class="font-bold">Panero Guti√©rrez, R.</span>: Derecho Romano, Tirant, 2021.</p></li></ul><h3 class="text-2xl font-semibold text-secondary mt-8 mb-4">Webs de inter√©s</h3><ul class="list-disc list-inside space-y-2"><li><a href="https://www.boe.es/biblioteca_juridica/publicacion.php?id=PUB-DR-2022-266_FUENTES_DEL_DERECHO_ROMANO_ONLINE&tipo=L&modo=1" target="_blank" class="text-amber-600 hover:text-amber-800 font-bold">Fuentes del Derecho Romano (BOE)</a></li><li><a href="https://droitromain.univ-grenoble-alpes.fr/" target="_blank" class="text-amber-600 hover:text-amber-800 font-bold">The Roman Law Library</a></li></ul><h3 class="text-2xl font-semibold text-secondary mt-6 mb-2">Recursos Adicionales</h3><ul class="list-disc list-inside space-y-2"><li><a href="https://webs.um.es/jal/" target="_blank" rel="noopener noreferrer" class="text-amber-600 hover:text-amber-800 font-bold">Web del profesor Joaqu√≠n Ataz L√≥pez</a></li><li><a href="https://derecho-romano.blogspot.com/" target="_blank" rel="noopener noreferrer" class="text-amber-600 hover:text-amber-800 font-bold">Blog de Derecho Romano</a></li><li><a href="https://www.youtube.com/playlist?list=PLhqyfgIdoGr2SrQMeLPg9Bdl4ThnF16a3" target="_blank" rel="noopener noreferrer" class="text-amber-600 hover:text-amber-800 font-bold">V√≠deos: Derecho Romano y Tradici√≥n Roman√≠stica (YouTube)</a></li><li><a href="https://www.um.es/web/biblioteca/conoce-biblioteca/biblioteca/puntos-de-servicio/biblioteca-juridica/acceso-a-los-recursos-electr%C3%B3nicos-de-cc-jur%C3%ADdicas-y-sociales" target="_blank" rel="noopener noreferrer" class="text-amber-600 hover:text-amber-800 font-bold">Recursos electr√≥nicos de CC. Jur√≠dicas y Sociales (UMU)</a></li><li><a href="https://www.um.es/web/derecho/conoce-la-facultad/estructura/servicios/biblioteca-digital" target="_blank" rel="noopener noreferrer" class="text-amber-600 hover:text-amber-800 font-bold">Biblioteca Digital de la Facultad de Derecho (UMU)</a></li><li><a href="https://share.podimo.com/s/ygbZufG6" target="_blank" rel="noopener noreferrer" class="text-amber-600 hover:text-amber-800 font-bold">tres meses gratis de suscripci√≥n a Podimo</a></li><li>Casos pr√°cticos resueltos en clase.</li><li>Tutor√≠as con el profesor.</li><li style="list-style-type: none; margin-top: 8px;"><iframe data-testid="embed-iframe" style="border-radius:12px" src="https://open.spotify.com/embed/playlist/3zkPCEoTEafhA25h3y51D9?utm_source=generator" width="100%" height="352" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe></li></ul></section>`
            }
        };

        function renderContent(hash) {
            const page = contentMap[hash] || contentMap['#home'];
            contentArea.innerHTML = `<div class="flex items-center space-x-4 mb-6 pb-4 border-b border-gray-300"><h1 class="font-heading text-4xl font-bold text-secondary">${page.title}</h1></div>${page.html}`;
            updateActiveNavLink(hash);
            if (hash === '#infografia') {
                initializeInfographicScripts();
            } else if (hash === '#caselab') {
                initializeCaseLabScripts();
            } else if (hash === '#ulpiano') {
                initializeUlpianoScripts();
            }
        }

        function updateActiveNavLink(hash) {
            const activeClasses = ['font-bold', 'text-amber-500', 'bg-slate-700'];
            document.querySelectorAll('nav a').forEach(link => link.classList.remove(...activeClasses));
            const activeLink = document.querySelector(`nav a[href="${hash}"]`);
            if (activeLink) activeLink.classList.add(...activeClasses);
        }

        window.addEventListener('hashchange', handleNavigation);
        document.addEventListener('DOMContentLoaded', handleNavigation);

        function handleNavigation() {
            const hash = window.location.hash || '#home';
            renderContent(hash);
        }

        function toggleSidebar() {
            sidebar.classList.toggle('-translate-x-full');
            sidebarOverlay.classList.toggle('hidden');
        }
        menuButton.addEventListener('click', toggleSidebar);
        sidebarOverlay.addEventListener('click', toggleSidebar);
        document.querySelectorAll('#sidebar a').forEach(link => {
            link.addEventListener('click', () => { if (window.innerWidth < 768) toggleSidebar(); });
        });

        // --- FUNCI√ìNES PARA LLAMAR A NUESTRO SERVIDOR ---
        async function callGeminiAPI(promptOriginal, termino = null) {
           const apiUrl = 'https://derechoromano-ecma.onrender.com/api/consulta';
            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        promptOriginal: promptOriginal,
                        termino: termino 
                    })
                });

                if (!response.ok) {
                    throw new Error(`Error del servidor: ${response.status}`);
                }
                const result = await response.json();
                return result.respuesta; 
            } catch (error) {
                console.error("Error llamando al API principal:", error);
                return "Error al contactar con el servicio de IA a trav√©s del servidor.";
            }
        }


        function initializeInfographicScripts() {
            const donutCanvas = document.getElementById('donutChart');
            if(donutCanvas && !Chart.getChart(donutCanvas)) {
                new Chart(donutCanvas.getContext('2d'), { type: 'doughnut', data: { labels: ['Derecho Civil (Ra√≠z Romana)', 'Common Law (Derecho Anglosaj√≥n)', 'Otros Sistemas'], datasets: [{ data: [60, 27, 13], backgroundColor: ['#FF5733', '#FFC300', '#DAF7A6'], borderColor: '#ffffff', borderWidth: 2 }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom' } } } });
            }
            const mapDiv = document.getElementById('mapChart');
            if(mapDiv && !mapDiv.hasChildNodes()) {
                const civilLawCountries = ['ALB', 'DZA', 'AND', 'AGO', 'ARG', 'ARM', 'AUT', 'AZE', 'BLR', 'BEL', 'BEN', 'BOL', 'BIH', 'BRA', 'BGR', 'BFA', 'BDI', 'KHM', 'CMR', 'CPV', 'CAF', 'TCD', 'CHL', 'COL', 'COG', 'COD', 'CRI', 'CIV', 'HRV', 'CUB', 'CZE', 'DNK', 'DJI', 'DOM', 'ECU', 'EGY', 'SLV', 'GNQ', 'EST', 'ETH', 'FIN', 'FRA', 'GAB', 'GEO', 'DEU', 'GRC', 'GTM', 'GIN', 'GNB', 'HTI', 'HND', 'HUN', 'ISL', 'IDN', 'IRN', 'IRQ', 'ISR', 'ITA', 'JPN', 'JOR', 'KAZ', 'KWT', 'KGZ', 'LAO', 'LVA', 'LBN', 'LBY', 'LIE', 'LTU', 'LUX', 'MAC', 'MDG', 'MLI', 'MLT', 'MRT', 'MUS', 'MEX', 'MDA', 'MCO', 'MNG', 'MNE', 'MAR', 'MOZ', 'NLD', 'NIC', 'NER', 'MKD', 'NOR', 'PAN', 'PRY', 'PER', 'PHL', 'POL', 'PRT', 'QAT', 'ROU', 'RUS', 'RWA', 'SMR', 'STP', 'SAU', 'SEN', 'SRB', 'SVK', 'SVN', 'SOM', 'KOR', 'ESP', 'SDN', 'SWE', 'CHE', 'SYR', 'TWN', 'TJK', 'THA', 'TLS', 'TGO', 'TUN', 'TUR', 'TKM', 'UKR', 'ARE', 'URY', 'UZB', 'VEN', 'VNM', 'YEM'];
                Plotly.newPlot('mapChart', [{ type: 'choropleth', locationmode: 'ISO-3', locations: civilLawCountries, z: Array(civilLawCountries.length).fill(1), colorscale: [[0, '#FFC300'], [1, '#C70039']], showscale: false, hoverinfo: 'text' }], { geo: { projection: { type: 'robinson' }, showland: true, landcolor: 'rgb(217, 217, 217)', subunitcolor: 'rgb(255, 255, 255)' }, title: { text: 'Pa√≠ses con Sistemas de Derecho Civil (Influencia Romana)', font: { family: 'Inter, sans-serif', size: 18, color: '#212529' } }, margin: { l: 0, r: 0, b: 0, t: 40 } }, {responsive: true});
            }
            document.querySelectorAll('.gemini-explain-btn').forEach(button => button.addEventListener('click', async () => {
                const concept = button.dataset.concept;
                document.getElementById('explanation-modal-title').innerText = `Explicando: ${concept}`;
                document.getElementById('explanation-modal-content').innerHTML = '<div class="loader mx-auto"></div>';
                document.getElementById('explanation-modal').classList.remove('hidden');
                
                const prompt = `Explica el concepto de '${concept}' en el Derecho Romano de forma muy sencilla, en menos de 100 palabras, como si fuera para un estudiante que nunca ha o√≠do hablar de ello.`;
                const explanation = await callGeminiAPI(prompt, concept); 

                document.getElementById('explanation-modal-content').innerHTML = `<p>${explanation}</p>`;
            }));
            document.getElementById('close-explanation-modal-btn').addEventListener('click', () => document.getElementById('explanation-modal').classList.add('hidden'));
        }

        function initializeCaseLabScripts() {
            const generateCaseBtn = document.getElementById('generate-case-btn'), caseStudyInput = document.getElementById('case-study-input'), caseStudyResult = document.getElementById('case-study-result'), solveCaseBtn = document.getElementById('solve-case-btn'), caseSolutionResult = document.getElementById('case-solution-result');
            
            if(generateCaseBtn) generateCaseBtn.addEventListener('click', async () => {
                const term = caseStudyInput.value.trim();
                const termLower = term.toLowerCase();

                // --- FILTRO ANTI-TROLEO ---
                const esInapropiado = palabrasProhibidas.some(palabra => termLower.includes(palabra));
                if (esInapropiado) {
                    caseStudyResult.innerHTML = `<p>${respuestaCiceron.replace(/\n/g, '<br>')}</p>`;
                    if(solveCaseBtn) solveCaseBtn.classList.add('hidden');
                    if(caseSolutionResult) caseSolutionResult.classList.add('hidden');
                    return;
                }

                if (!term) { caseStudyResult.innerHTML = '<p class="text-red-500">Por favor, introduce un t√©rmino legal.</p>'; return; }
                const btnText = document.getElementById('btn-text');
                const btnLoader = document.getElementById('btn-loader');
                if(btnText) btnText.classList.add('hidden');
                if(btnLoader) btnLoader.classList.remove('hidden');
                generateCaseBtn.disabled = true;
                caseStudyResult.innerHTML = '<div class="loader mx-auto"></div>';
                solveCaseBtn.classList.add('hidden');
                caseSolutionResult.classList.add('hidden');

                const prompt = `Crea un breve y sencillo caso de estudio (menos de 150 palabras) basado en el derecho romano que ilustre el concepto jur√≠dico de '${term}'. El caso debe involucrar personajes con nombres romanos (ej. Ticio, Cayo, Sempronio, Mevio o Livia). La respuesta debe ser en espa√±ol. No des la soluci√≥n en el planteamiento del caso`;
                
                const caseText = await callGeminiAPI(prompt, term);
                
                caseStudyResult.dataset.caseText = caseText;
                caseStudyResult.innerHTML = `<p>${caseText.replace(/\n/g, '<br>')}</p>`;
                if(btnText) btnText.classList.remove('hidden');
                if(btnLoader) btnLoader.classList.add('hidden');
                generateCaseBtn.disabled = false;
                solveCaseBtn.classList.remove('hidden');
            });

            if(solveCaseBtn) solveCaseBtn.addEventListener('click', async () => {
                const term = caseStudyInput.value.trim(), currentCaseText = caseStudyResult.dataset.caseText;
                const solveBtnText = document.getElementById('solve-btn-text');
                const solveBtnLoader = document.getElementById('solve-btn-loader');
                if(solveBtnText) solveBtnText.classList.add('hidden');
                if(solveBtnLoader) solveBtnLoader.classList.remove('hidden');
                solveCaseBtn.disabled = true;
                caseSolutionResult.classList.remove('hidden'); caseSolutionResult.innerHTML = '<div class="loader mx-auto"></div>';
                
                const indexContent = "Historia de Roma: 53, rep√∫blica romana: 55, principado: 65, dominado: 68, justiniano: 73, persona: 86, capacidad: 94, esclavo: 87, familia: 96, dote: 98, matrimonio: 97, ineficacia del negocio jur√≠dico: 111, legis actiones: 112, per formulas: 120, cognitio: 136, posesi√≥n: 144, propiedad: 149, usucapi√≥n: 155, acci√≥n publiciana: 166, solidaridad: 177, mancomunidad: 177, delitos: 179, hurto: 180, robo: 180, Mutuo: 188, Comodato: 188, Dep√≥sito: 189, Fiducia: 190, Prenda (pignus): 191, Hipoteca (pignus conventum): 192, Compraventa (emptio venditio): 196, Arrendamiento (locatio conductio): 199, Sociedad (societas): 202, Mandato (mandatum): 203, Donaci√≥n: 204, Stipulatio: 207, Sucesi√≥n mortis causa: 215, Sucesi√≥n intestada: 221, Sucesi√≥n testamentaria: 226, Legados: 232, Fideicomisos: 234, Sucesi√≥n forzosa o legitimaria: 236, Usufructo: 161, Servidumbres: 158, Patria Potestas: 100, Negocio jur√≠dico: 105, vicios de la voluntad: 105, error 105, dolo: 105 y 179, metus (intimidaci√≥n): 105, representaci√≥n: 106, simulaci√≥n: 106, condici√≥n: 106, t√©rmino: 106, modo: 106, Delitos: 179, Da√±o: 181, Iniuriae (lesiones y ofensas): 182";
                
                 const solutionPrompt = `Analiza el siguiente caso de derecho romano: "${currentCaseText}".
1. **Soluci√≥n Jur√≠dica:** Proporciona una soluci√≥n clara y razonada en espa√±ol, basada estrictamente en los principios del derecho romano.
2. **Fuente Cl√°sica Obligatoria:** Tu tarea es encontrar un pasaje relevante del Digesto que se aplique al caso. Tu respuesta para este punto DEBE incluir obligatoriamente estos tres elementos: la notaci√≥n acad√©mica (ej. D. 18.1.1), el texto original en lat√≠n, y la traducci√≥n completa al espa√±ol. No parafrasees ni describas el contenido; DEBES citar el texto directamente.
3. **Referencia al Manual:** Busca el concepto principal ('${term}') en este √≠ndice: [${indexContent}].
4. **Nota Final:** Concluye tu respuesta con una referencia en una nueva l√≠nea con el formato: 'Para m√°s informaci√≥n, consultar el manual en la p√°g. [n√∫mero de p√°gina]'.`;
                
                const solutionText = await callGeminiAPI(solutionPrompt, term);
                
                caseSolutionResult.innerHTML = `<h4 class="font-bold text-lg mb-2 text-green-800">Soluci√≥n Propuesta:</h4><p>${solutionText.replace(/\n/g, '<br>')}</p>`;
                if(solveBtnText) solveBtnText.classList.remove('hidden');
                if(solveBtnLoader) solveBtnLoader.classList.add('hidden');
                solveCaseBtn.disabled = false;
            });
        }
        
        function initializeUlpianoScripts() {
            const submitQueryBtn = document.getElementById('submitQueryBtn');
            const queryInput = document.getElementById('queryInput');
            const queryResult = document.getElementById('queryResult');
            const queryResultText = document.getElementById('queryResultText');
            const submitBtnText = document.getElementById('submit-btn-text');
            const submitBtnLoader = document.getElementById('submit-btn-loader');

            async function callFontAPI(termino) {
                try {
                    const response = await fetch('https://derechoromano-ecma.onrender.com/api/buscar-fuente', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ termino: termino })
                    });
                    if (!response.ok) return null;
                    const result = await response.json();
                    return result.fuente;
                } catch (error) { console.error("Error en API de fuentes:", error); return null; }
            }
            
            async function callModernoAPI(termino) {
                try {
                    const response = await fetch('https://derechoromano-ecma.onrender.com/api/derecho-moderno', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ termino: termino })
                    });
                    if (!response.ok) return null;
                    const result = await response.json();
                    return result.moderno;
                } catch (error) { console.error("Error en API de derecho moderno:", error); return null; }
            }

            if (submitQueryBtn) submitQueryBtn.addEventListener('click', async () => {
                const userQuery = queryInput.value.trim();
                const userQueryLower = userQuery.toLowerCase();

                const esInapropiado = palabrasProhibidas.some(palabra => userQueryLower.includes(palabra));

                if (esInapropiado) {
                    queryResult.classList.remove('hidden');
                    queryResultText.innerHTML = respuestaCiceron.replace(/\n/g, '<br>');
                    return;
                }

                if (!userQuery) {
                    queryResultText.innerText = 'Por favor, introduce una pregunta.';
                    queryResult.classList.remove('hidden');
                    return;
                }
                
                submitQueryBtn.disabled = true;
                submitBtnText.classList.add('hidden');
                submitBtnLoader.classList.remove('hidden');
                queryResult.classList.remove('hidden');
                queryResultText.innerHTML = '<div class="loader mx-auto" style="border-top-color:#C70039;"></div>';

                const manualIndex = "Historia de Roma: 53, rep√∫blica romana: 55, principado: 65, dominado: 68, justiniano: 73, persona: 86, capacidad: 94, esclavo: 87, familia: 96, dote: 98, matrimonio: 97, ineficacia del negocio jur√≠dico: 111, legis actiones: 112, per formulas: 120, cognitio: 136, posesi√≥n: 144, propiedad: 149, usucapi√≥n: 155, acci√≥n publiciana: 166, solidaridad: 177, mancomunidad: 177, delitos: 179, hurto: 180, robo: 180, Mutuo: 188, Comodato: 188, Dep√≥sito: 189, Fiducia: 190, Prenda (pignus): 191, Hipoteca (pignus conventum): 192, Compraventa (emptio venditio): 196, Arrendamiento (locatio conductio): 199, Sociedad (societas): 202, Mandato (mandatum): 203, Donaci√≥n: 204, Stipulatio: 207, Sucesi√≥n mortis causa: 215, Sucesi√≥n intestada: 221, Sucesi√≥n testamentaria: 226, Legados: 232, Fideicomisos: 234, Sucesi√≥n forzosa o legitimaria: 236, Usufructo: 161, Servidumbres: 158, Patria Potestas: 100, Negocio jur√≠dico: 105, vicios de la voluntad: 105, error 105, dolo: 105 y 179, metus (intimidaci√≥n): 105, representaci√≥n: 106, simulaci√≥n: 106, condici√≥n: 106, t√©rmino: 106, modo: 106, Delitos: 179, Da√±o: 181, Iniuriae (lesiones y ofensas): 182";
                
                const promptPrincipal = `Eres Ulpiano, un jurisconsulto romano del siglo III d.C. Responde a la pregunta: "${userQuery}".
Tu respuesta debe contener √∫nicamente los siguientes puntos, separados por "---":
1.  **Respuesta Jur√≠dica:** Proporciona una respuesta clara y concisa en espa√±ol, basada en los principios del derecho romano. Si el contexto del manual proporcionado es relevante, √∫salo de forma prioritaria.
2.  **Referencia al Manual:** Termina siempre tu respuesta con una de estas dos opciones:
    * Si la pregunta coincide claramente con uno de los siguientes temas, usa el formato: "Para m√°s informaci√≥n, consultar el manual en la p√°g. [n√∫mero de p√°gina]".
    * En cualquier otro caso, usa el formato gen√©rico: "Para m√°s informaci√≥n, se recomienda consultar el manual de la asignatura."

Lista de temas del manual: [${manualIndex}]`;

                const [respuestaPrincipal, respuestaFuente, respuestaModerno] = await Promise.all([
                    callGeminiAPI(promptPrincipal, userQuery), 
                    callFontAPI(userQuery),                
                    callModernoAPI(userQuery)              
                ]);
                
                let resultadoFinal = [];
                let contador = 1;

                const partesPrincipales = respuestaPrincipal.split(/2\.\s\*\*Referencia al Manual:\*\*/);
                const respuestaJuridica = partesPrincipales[0].replace(/1\.\s\*\*Respuesta Jur√≠dica:\*\*/, "").trim();
                const referenciaManual = partesPrincipales[1] ? partesPrincipales[1].trim() : "Para m√°s informaci√≥n, se recomienda consultar el manual de la asignatura.";
                
                resultadoFinal.push(`${contador}. **Respuesta Jur√≠dica:**\n${respuestaJuridica}`);
                contador++;

                if (respuestaFuente && !respuestaFuente.trim().includes("NULL")) {
                    resultadoFinal.push(`${contador}. **Fuente Cl√°sica:**\n${respuestaFuente.trim()}`);
                    contador++;
                }

                if (respuestaModerno && !respuestaModerno.trim().includes("NULL")) {
                    resultadoFinal.push(`${contador}. **Vigencia en el Derecho Moderno:**\n${respuestaModerno.trim()}`);
                    contador++;
                }

                resultadoFinal.push(`${contador}. **Referencia al Manual:**\n${referenciaManual}`);
                
                const textoFinal = resultadoFinal.join('\n\n');
                queryResultText.innerHTML = textoFinal.replace(/\n/g, '<br>');

                submitBtnText.classList.remove('hidden');
                submitBtnLoader.classList.add('hidden');
                submitQueryBtn.disabled = false;
            });
        }
    </script>
</body>
</html>