<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Infografía: La Triple Protección del Propietario Pretorio</title>
    <!-- Incluimos Tailwind CSS desde el CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Usamos la fuente Inter, que es limpia y moderna */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Animación para las tarjetas */
        .info-card {
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        .info-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        /* Estilo para las flechas del "diálogo" procesal */
        .procedural-arrow::after {
            content: '→';
            display: block;
            font-size: 1.5rem;
            font-weight: bold;
            color: #9ca3af; /* gray-400 */
            margin: 0.5rem 0;
        }
        /* Estilos para el modal y el loader */
        .modal {
            transition: opacity 0.25s ease;
        }
        .modal-content {
            transition: transform 0.25s ease;
        }
        .loader {
            border-top-color: #4338ca; /* indigo-700 */
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
    </style>
</head>
<body class="bg-slate-100 p-4 md:p-8 antialiased">

    <!-- Contenedor principal de la infografía -->
    <div class="max-w-7xl mx-auto bg-white shadow-2xl rounded-2xl overflow-hidden">
        
        <!-- Cabecera -->
        <header class="bg-gradient-to-r from-blue-900 to-indigo-700 p-6 md:p-8 text-white shadow-lg">
            <h1 class="text-2xl md:text-3xl font-bold">La Triple Protección del Propietario Pretorio</h1>
            <p class="text-lg md:text-xl opacity-90 mt-1">Cómo el Pretor protegía al comprador de buena fe.</p>
        </header>

        <!-- Contenido principal -->
        <main class="p-6 md:p-8">

            <!-- Sección 1: Las 3 Capas de Protección -->
            <section class="mb-12">
                <h2 class="text-2xl md:text-3xl font-semibold text-slate-800 border-b-2 border-blue-400 pb-3 mb-8">
                    Las Tres "Capas" de Protección
                </h2>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8">

                    <!-- Capa 1: Interdictos -->
                    <div class="info-card flex flex-col p-6 bg-slate-50 rounded-lg shadow-lg border-t-4 border-blue-500">
                        <div class="flex items-center mb-4">
                            <!-- Icono de "Mano (Parar)" -->
                            <div class="w-16 h-16 bg-blue-100 text-blue-700 rounded-full flex items-center justify-center mr-4 flex-shrink-0">
                                <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M15.5 15.5l-1.06-1.06a5.5 5.5 0 01-7.78 0l-1.06 1.06a7.5 7.5 0 0010.606 0zM12 9a2.5 2.5 0 100-5 2.5 2.5 0 000 5z" />
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 17.5V14l-3-3 3-3v2.5a5.5 5.5 0 011.16-9.043 7.5 7.5 0 00-10.326 10.326A5.5 5.5 0 0112 17.5z" />
                                </svg>
                            </div>
                            <h3 class="font-bold text-2xl text-blue-800">1. Interdictos Posesorios</h3>
                        </div>
                        <p class="text-lg text-slate-700 mb-4 flex-grow">
                            Como cualquier poseedor, podía defender su <span class="font-semibold">tenencia de hecho</span> contra perturbaciones.
                        </p>
                        <p class="text-lg font-semibold text-blue-900 bg-blue-100 p-2 rounded-md inline-block">
                            Vía Rápida pero Provisional
                        </p>
                    </div>

                    <!-- Capa 2: Usucapión -->
                    <div class="info-card flex flex-col p-6 bg-slate-50 rounded-lg shadow-lg border-t-4 border-blue-500">
                        <div class="flex items-center mb-4">
                            <!-- Icono de "Puente" -->
                            <div class="w-16 h-16 bg-blue-100 text-blue-700 rounded-full flex items-center justify-center mr-4 flex-shrink-0">
                                <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                            </div>
                            <h3 class="font-bold text-2xl text-blue-800">2. La Usucapión</h3>
                        </div>
                        <p class="text-lg text-slate-700 mb-4 flex-grow">
                            El "puente" hacia el *Ius Civile*. Convertía su posesión (hecho) en <span class="font-semibold">propiedad civil (Derecho)</span> por el paso del tiempo.
                        </p>
                        <p class="text-lg font-semibold text-blue-900 bg-blue-100 p-2 rounded-md inline-block">
                            Destino Final y Consolidación
                        </p>
                        <div class="mt-4 text-sm text-slate-600">
                            <span class="font-semibold">Requisitos Clásicos:</span> *Res Habilis*, *Iustus Titulus*, *Fides*, *Possessio* y *Tempus* (1 año muebles, 2 inmuebles).
                        </div>
                    </div>

                    <!-- Capa 3: Acción Publiciana -->
                    <div class="info-card flex flex-col p-6 bg-yellow-50 rounded-lg shadow-lg border-t-4 border-yellow-500">
                        <div class="flex items-center mb-4">
                            <!-- Icono de "Espada/Acción" -->
                            <div class="w-16 h-16 bg-yellow-100 text-yellow-700 rounded-full flex items-center justify-center mr-4 flex-shrink-0">
                                <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 11c0-3.517 3.134-6.364 7-6.364 3.866 0 7 2.847 7 6.364 0 3.517-3.134 6.364-7 6.364-3.866 0-7-2.847-7-6.364zM2 11c0-3.517 3.134-6.364 7-6.364 3.866 0 7 2.847 7 6.364 0 3.517-3.134 6.364-7 6.364-3.866 0-7-2.847-7-6.364z" />
                                </svg>
                            </div>
                            <h3 class="font-bold text-2xl text-yellow-800">3. ACCIÓN PUBLICIANA</h3>
                        </div>
                        <p class="text-lg text-slate-700 mb-4 flex-grow">
                            La <span class="font-bold">HERRAMIENTA CLAVE</span>. Una acción ficticia que protegía al poseedor *antes* de completar la usucapión.
                        </p>
                        <p class="text-lg font-semibold text-yellow-900 bg-yellow-100 p-2 rounded-md inline-block">
                            La Genialidad del Pretor
                        </p>
                        <div class="mt-4 text-sm text-slate-600">
                           <span class="font-semibold">La Ficción:</span> El Pretor ordenaba al Juez <span class="font-bold">"fingir que el tiempo de la usucapión ya había transcurrido"</span>.
                        </div>
                    </div>

                </div>
            </section>

            <!-- Sección 2: La Eficacia de la Acción Publiciana -->
            <section class="mb-6">
                <h2 class="text-2xl md:text-3xl font-semibold text-slate-800 border-b-2 border-blue-400 pb-3 mb-8">
                    La Eficacia de la Acción Publiciana: Los 2 Casos
                </h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">

                    <!-- Caso 1: A Non Domino -->
                    <div class="info-card flex flex-col p-6 bg-red-50 rounded-lg shadow-lg border-t-4 border-red-600">
                        <h3 class="font-bold text-xl text-red-800 mb-4">CASO 1: Adquisición "a non domino" (de un NO-Dueño)</h3>
                        <p class="text-slate-700 mb-4 flex-grow">El Propietario Pretorio (PP) gana contra todos... <span class="font-bold text-red-700">EXCEPTO</span> contra el verdadero propietario civil (*Verus Dominus*).</p>
                        
                        <div class="bg-white p-4 rounded-lg shadow-md border-l-4 border-red-500">
                            <h4 class="font-bold text-slate-800 mb-2">Batalla Procesal:</h4>
                            <div class="text-slate-700 space-y-2">
                                <p class="procedural-arrow"><span class="font-semibold text-blue-700">[PP]</span> ataca con la <span class="font-bold">Acción Publiciana</span>.</p>
                                <p class="procedural-arrow"><span class="font-semibold text-red-700">[Verus Dominus]</span> se defiende con la <span class="font-bold text-red-700">Exceptio Iusti Dominii</span> (Excepción de justo dominio).</p>
                                <p class="flex items-center">
                                    <span class="text-2xl font-bold text-red-700 mr-2">→</span>
                                    <span class="font-bold text-xl text-red-700">EL PROPIETARIO PRETORIO PIERDE.</span>
                                </p>
                            </div>
                            <button onclick="generarCaso('A non domino')" class="w-full text-sm bg-blue-800 text-white px-3 py-2 rounded-md hover:bg-blue-900 transition-all mt-4">✨ Generar Caso</button>
                        </div>
                    </div>

                    <!-- Caso 2: Defecto de Forma -->
                    <div class="info-card flex flex-col p-6 bg-green-50 rounded-lg shadow-lg border-t-4 border-green-600">
                        <h3 class="font-bold text-xl text-green-800 mb-4">CASO 2: Defecto de Forma (Compra al Dueño por *Traditio*)</h3>
                        <p class="text-slate-700 mb-4 flex-grow">¡Aquí la protección es <span class="font-bold text-green-700">ABSOLUTA</span>, incluso contra el *Verus Dominus* (vendedor)!</p>
                        
                        <div class="bg-white p-4 rounded-lg shadow-md border-l-4 border-green-500 mb-4">
                            <h4 class="font-bold text-slate-800 mb-2">Batalla 1: Si el PP es DEMANDADO por el dueño:</h4>
                            <div class="text-slate-700 space-y-2">
                                <p class="procedural-arrow"><span class="font-semibold text-red-700">[Verus Dominus]</span> ataca con la <span class="font-bold">Acción Reivindicatoria</span>.</p>
                                <p class="procedural-arrow"><span class="font-semibold text-green-700">[PP]</span> se defiende con la <span class="font-bold text-green-700">Exceptio Rei Venditae et Traditae</span> (Excepción de cosa vendida y entregada).</p>
                                <p class="flex items-center">
                                    <span class="text-2xl font-bold text-green-700 mr-2">→</span>
                                    <span class="font-bold text-xl text-green-700">EL PROPIETARIO PRETORIO GANA.</span>
                                </p>
                            </div>
                            <button onclick="generarCaso('Defecto de forma (demandado)')" class="w-full text-sm bg-blue-800 text-white px-3 py-2 rounded-md hover:bg-blue-900 transition-all mt-4">✨ Generar Caso (Exceptio)</button>
                        </div>

                        <div class="bg-white p-4 rounded-lg shadow-md border-l-4 border-green-500">
                            <h4 class="font-bold text-slate-800 mb-2">Batalla 2: Si el PP (que perdió la posesión) DEMANDA al dueño:</h4>
                            <div class="text-slate-700 space-y-2">
                                <p class="procedural-arrow"><span class="font-semibold text-green-700">[PP]</span> ataca con la <span class="font-bold">Acción Publiciana</span>.</p>
                                <p class="procedural-arrow"><span class="font-semibold text-red-700">[Verus Dominus]</span> se defiende con la <span class="font-bold text-red-700">Exceptio Iusti Dominii</span>.</p>
                                <p class="procedural-arrow"><span class="font-semibold text-green-700">[PP]</span> responde con la <span class="font-bold text-green-700">Replicatio Doli</span> (Réplica de dolo: "actúas con dolo al ir contra tu propio acto de venta").</p>
                                <p class="flex items-center">
                                    <span class="text-2xl font-bold text-green-700 mr-2">→</span>
                                    <span class="font-bold text-xl text-green-700">EL PROPIETARIO PRETORIO GANA.</span>
                                </p>
                            </div>
                            <button onclick="generarCaso('Defecto de forma (demandante)')" class="w-full text-sm bg-blue-800 text-white px-3 py-2 rounded-md hover:bg-blue-900 transition-all mt-4">✨ Generar Caso (Replicatio)</button>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Sección 3: Conclusión -->
            <section class="mt-12">
                 <div class="bg-blue-50 p-6 rounded-lg shadow-inner border border-blue-200 text-center">
                    <h2 class="text-2xl font-bold text-slate-800">Conclusión: La Dualidad del Derecho Romano</h2>
                    <p class="text-lg text-slate-700 max-w-4xl mx-auto mt-3">
                        El Pretor no "destruía" el *Ius Civile* (el vendedor seguía siendo dueño civil), pero lo <span class="font-bold">superaba por la vía de la equidad</span>. Protegía al comprador de buena fe con tanta eficacia que, en la práctica, su posesión era más fuerte que la "propiedad desnuda" (*nuda proprietas*) del vendedor.
                    </p>
                </div>
            </section>

        </main>
    </div>

    <!-- Modal para mostrar la respuesta de Gemini -->
    <div id="geminiModal" class="modal fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 opacity-0 pointer-events-none">
        <div class="modal-content bg-white rounded-lg shadow-lg w-11/12 md:w-1/2 lg:w-1/3 p-6 transform scale-95">
            <div class="flex justify-between items-center mb-4">
                <h3 id="modalTitle" class="text-xl font-bold text-gray-800"></h3>
                <button onclick="closeModal()" class="text-gray-500 hover:text-gray-800 text-3xl">&times;</button>
            </div>
            <div id="modalBody" class="text-slate-700 whitespace-pre-wrap overflow-y-auto max-h-96">
                <!-- El contenido generado por Gemini irá aquí -->
            </div>
            <div class="text-right mt-6">
                <button onclick="closeModal()" class="bg-blue-800 text-white px-4 py-2 rounded-lg hover:bg-blue-900 transition-all">Cerrar</button>
            </div>
        </div>
    </div>

    <!-- Overlay de carga -->
    <div id="loader" class="fixed inset-0 z-60 flex items-center justify-center bg-black bg-opacity-25 hidden">
        <div class="loader ease-linear rounded-full border-8 border-t-8 border-gray-200 h-24 w-24"></div>
    </div>

    <script>
        const modal = document.getElementById('geminiModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalBody = document.getElementById('modalBody');
        const loader = document.getElementById('loader');

        function openModal(title, content) {
            modalTitle.textContent = title;
            // Reemplaza los saltos de línea de texto con <br> y negritas
            let htmlContent = content.replace(/\*\*(.*?)\*\*/g, '<strong class="font-bold text-slate-800">$1</strong>');
            htmlContent = htmlContent.replace(/\n/g, '<br>');
            modalBody.innerHTML = htmlContent;
            
            modal.classList.remove('opacity-0', 'pointer-events-none');
            modal.querySelector('.modal-content').classList.remove('scale-95');
        }

        function closeModal() {
            modal.querySelector('.modal-content').classList.add('scale-95');
            modal.classList.add('opacity-0', 'pointer-events-none');
        }

        function showLoader() {
            loader.classList.remove('hidden');
        }

        function hideLoader() {
            loader.classList.add('hidden');
        }

        // Función de prompt personalizada
        function getPromptForTopic(topic) {
            switch(topic) {
                case 'A non domino':
                    return `Eres un profesor experto en Derecho Romano. Genera un breve caso práctico (casus) sobre una **adquisición 'a non domino'**. Ticio (Propietario Pretorio) compra de buena fe un esclavo a Mevio, quien no era el verdadero dueño. Más tarde, Cayo (el 'verus dominus') reconoce a su esclavo y lo reclama.
Después del caso, proporciona una 'Responsa' (solución) clara, explicando la batalla procesal: Ticio usa la *Acción Publiciana*, pero Cayo la paraliza con la *exceptio iusti dominii*, y Ticio pierde.
Formato:
**Caso:** [Tu caso aquí]
**Solución (Responsa):** [Tu solución aquí]`;
                case 'Defecto de forma (demandado)':
                    return `Eres un profesor experto en Derecho Romano. Genera un breve caso práctico (casus) sobre un **defecto de forma**. Ticio (Propietario Civil) vende y entrega (*traditio*) un esclavo (*res mancipi*) a Cayo (Propietario Pretorio). Ticio, amparándose en el *Ius Civile*, demanda a Cayo con la *Acción Reivindicatoria*.
Después del caso, proporciona una 'Responsa' (solución) clara, explicando la batalla procesal: Cayo paraliza la acción de Ticio usando la *exceptio rei venditae et traditae* y gana.
Formato:
**Caso:** [Tu caso aquí]
**Solución (Responsa):** [Tu solución aquí]`;
                case 'Defecto de forma (demandante)':
                    return `Eres un profesor experto en Derecho Romano. Genera un breve caso práctico (casus) sobre un **defecto de forma**. Ticio (Propietario Civil) vende y entrega (*traditio*) un esclavo (*res mancipi*) a Cayo (Propietario Pretorio). Cayo pierde la posesión del esclavo, que vuelve a manos de Ticio. Cayo demanda a Ticio con la *Acción Publiciana*.
Después del caso, proporciona una 'Responsa' (solución) clara, explicando la batalla procesal: Ticio opone la *exceptio iusti dominii*, pero Cayo la anula con la *replicatio doli* y gana.
Formato:
**Caso:** [Tu caso aquí]
**Solución (Responsa):** [Tu solución aquí]`;
                default:
                    return `Genera un caso práctico sobre ${topic}.`;
            }
        }

        // Función principal para llamar a Gemini
        async function generarCaso(tipoCaso) {
            showLoader();
            
            const prompt = getPromptForTopic(tipoCaso);

            try {
                const response = await callGeminiAPI(prompt);
                hideLoader();
                openModal(`Caso Práctico: ${tipoCaso}`, response);
            } catch (error) {
                hideLoader();
                openModal('Error', 'No se pudo generar el caso práctico en este momento. Por favor, inténtelo de nuevo más tarde.');
            }
        }

        // Función de llamada a la API con reintentos (backoff exponencial)
        async function callGeminiAPI(prompt, retries = 3, delay = 1000) {
            const apiKey = ""; // Dejar vacío, se gestionará en el entorno
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;

            const payload = {
                contents: [{ parts: [{ text: prompt }] }],
            };

            for (let i = 0; i < retries; i++) {
                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        throw new Error(`Error en la API: ${response.statusText}`);
                    }

                    const result = await response.json();
                    
                    if (result.candidates && result.candidates.length > 0 &&
                        result.candidates[0].content && result.candidates[0].content.parts &&
                        result.candidates[0].content.parts.length > 0) {
                        return result.candidates[0].content.parts[0].text;
                    } else {
                        throw new Error('Respuesta inesperada de la API.');
                    }

                } catch (error) {
                    if (i === retries - 1) {
                        console.error('Error al llamar a la API de Gemini:', error);
                        throw error;
                    }
                    // Espera exponencial antes de reintentar
                    await new Promise(res => setTimeout(res, delay * Math.pow(2, i)));
                }
            }
            throw new Error('No se pudo obtener respuesta de la API después de varios intentos.');
        }

        // Cerrar modal si se hace clic fuera
        window.onclick = function(event) {
            if (event.target == modal) {
                closeModal();
            }
        }
    </script>
</body>
</html>